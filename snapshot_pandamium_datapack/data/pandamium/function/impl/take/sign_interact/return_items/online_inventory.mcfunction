execute store success score <moved_item> variable unless items entity @s hotbar.0 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.0 from block 2 1 0 container.18
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.18 with air
execute store success score <moved_item> variable unless items entity @s hotbar.1 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.1 from block 2 1 0 container.19
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.19 with air
execute store success score <moved_item> variable unless items entity @s hotbar.2 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.2 from block 2 1 0 container.20
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.20 with air
execute store success score <moved_item> variable unless items entity @s hotbar.3 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.3 from block 2 1 0 container.21
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.21 with air
execute store success score <moved_item> variable unless items entity @s hotbar.4 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.4 from block 2 1 0 container.22
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.22 with air
execute store success score <moved_item> variable unless items entity @s hotbar.5 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.5 from block 2 1 0 container.23
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.23 with air
execute store success score <moved_item> variable unless items entity @s hotbar.6 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.6 from block 2 1 0 container.24
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.24 with air
execute store success score <moved_item> variable unless items entity @s hotbar.7 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.7 from block 2 1 0 container.25
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.25 with air
execute store success score <moved_item> variable unless items entity @s hotbar.8 *
execute if score <moved_item> variable matches 1 run item replace entity @s hotbar.8 from block 2 1 0 container.26
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.26 with air

execute store success score <moved_item> variable unless items entity @s inventory.0 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.0 from block 2 0 0 container.18
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.18 with air
execute store success score <moved_item> variable unless items entity @s inventory.1 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.1 from block 2 0 0 container.19
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.19 with air
execute store success score <moved_item> variable unless items entity @s inventory.2 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.2 from block 2 0 0 container.20
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.20 with air
execute store success score <moved_item> variable unless items entity @s inventory.3 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.3 from block 2 0 0 container.21
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.21 with air
execute store success score <moved_item> variable unless items entity @s inventory.4 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.4 from block 2 0 0 container.22
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.22 with air
execute store success score <moved_item> variable unless items entity @s inventory.5 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.5 from block 2 0 0 container.23
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.23 with air
execute store success score <moved_item> variable unless items entity @s inventory.6 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.6 from block 2 0 0 container.24
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.24 with air
execute store success score <moved_item> variable unless items entity @s inventory.7 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.7 from block 2 0 0 container.25
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.25 with air
execute store success score <moved_item> variable unless items entity @s inventory.8 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.8 from block 2 0 0 container.26
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.26 with air
execute store success score <moved_item> variable unless items entity @s inventory.9 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.9 from block 2 1 0 container.0
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.0 with air
execute store success score <moved_item> variable unless items entity @s inventory.10 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.10 from block 2 1 0 container.1
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.1 with air
execute store success score <moved_item> variable unless items entity @s inventory.11 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.11 from block 2 1 0 container.2
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.2 with air
execute store success score <moved_item> variable unless items entity @s inventory.12 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.12 from block 2 1 0 container.3
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.3 with air
execute store success score <moved_item> variable unless items entity @s inventory.13 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.13 from block 2 1 0 container.4
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.4 with air
execute store success score <moved_item> variable unless items entity @s inventory.14 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.14 from block 2 1 0 container.5
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.5 with air
execute store success score <moved_item> variable unless items entity @s inventory.15 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.15 from block 2 1 0 container.6
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.6 with air
execute store success score <moved_item> variable unless items entity @s inventory.16 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.16 from block 2 1 0 container.7
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.7 with air
execute store success score <moved_item> variable unless items entity @s inventory.17 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.17 from block 2 1 0 container.8
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.8 with air
execute store success score <moved_item> variable unless items entity @s inventory.18 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.18 from block 2 1 0 container.9
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.9 with air
execute store success score <moved_item> variable unless items entity @s inventory.19 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.19 from block 2 1 0 container.10
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.10 with air
execute store success score <moved_item> variable unless items entity @s inventory.20 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.20 from block 2 1 0 container.11
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.11 with air
execute store success score <moved_item> variable unless items entity @s inventory.21 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.21 from block 2 1 0 container.12
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.12 with air
execute store success score <moved_item> variable unless items entity @s inventory.22 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.22 from block 2 1 0 container.13
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.13 with air
execute store success score <moved_item> variable unless items entity @s inventory.23 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.23 from block 2 1 0 container.14
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.14 with air
execute store success score <moved_item> variable unless items entity @s inventory.24 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.24 from block 2 1 0 container.15
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.15 with air
execute store success score <moved_item> variable unless items entity @s inventory.25 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.25 from block 2 1 0 container.16
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.16 with air
execute store success score <moved_item> variable unless items entity @s inventory.26 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.26 from block 2 1 0 container.17
execute if score <moved_item> variable matches 1 run item replace block 2 1 0 container.17 with air

execute store success score <moved_item> variable unless items entity @s armor.feet *
execute if score <moved_item> variable matches 1 run item replace entity @s armor.feet from block 2 0 0 container.10
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.10 with air
execute store success score <moved_item> variable unless items entity @s armor.legs *
execute if score <moved_item> variable matches 1 run item replace entity @s armor.legs from block 2 0 0 container.1
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.1 with air
execute store success score <moved_item> variable unless items entity @s armor.chest *
execute if score <moved_item> variable matches 1 run item replace entity @s armor.chest from block 2 0 0 container.9
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.9 with air
execute store success score <moved_item> variable unless items entity @s armor.head *
execute if score <moved_item> variable matches 1 run item replace entity @s armor.head from block 2 0 0 container.0
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.0 with air
#execute store success score <moved_item> variable unless items entity @s player.crafting.0 *
#execute if score <moved_item> variable matches 1 run item replace entity @s player.crafting.0 from block 2 0 0 container.6
#execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.6 with air
#execute store success score <moved_item> variable unless items entity @s player.crafting.1 *
#execute if score <moved_item> variable matches 1 run item replace entity @s player.crafting.1 from block 2 0 0 container.7
#execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.7 with air
#execute store success score <moved_item> variable unless items entity @s player.crafting.2 *
#execute if score <moved_item> variable matches 1 run item replace entity @s player.crafting.2 from block 2 0 0 container.15
#execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.15 with air
#execute store success score <moved_item> variable unless items entity @s player.crafting.3 *
#execute if score <moved_item> variable matches 1 run item replace entity @s player.crafting.3 from block 2 0 0 container.16
#execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.16 with air
execute store success score <moved_item> variable unless items entity @s weapon.offhand *
execute if score <moved_item> variable matches 1 run item replace entity @s weapon.offhand from block 2 0 0 container.11
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.11 with air
#execute store success score <moved_item> variable unless items entity @s player.cursor *
#execute if score <moved_item> variable matches 1 run item replace entity @s player.cursor from block 2 0 0 container.13
#execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.13 with air
#execute store success score <moved_item> variable unless items entity @s armor.body *
#execute if score <moved_item> variable matches 1 run item replace entity @s armor.body from block 2 0 0 container.2
#execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.2 with air
#execute store success score <moved_item> variable unless items entity @s saddle *
#execute if score <moved_item> variable matches 1 run item replace entity @s saddle from block 2 0 0 container.3
#execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.3 with air
execute store success score <moved_item> variable unless items entity @s inventory.0 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.0 from block 2 0 0 container.18
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.18 with air
execute store success score <moved_item> variable unless items entity @s inventory.1 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.1 from block 2 0 0 container.19
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.19 with air
execute store success score <moved_item> variable unless items entity @s inventory.2 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.2 from block 2 0 0 container.20
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.20 with air
execute store success score <moved_item> variable unless items entity @s inventory.3 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.3 from block 2 0 0 container.21
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.21 with air
execute store success score <moved_item> variable unless items entity @s inventory.4 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.4 from block 2 0 0 container.22
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.22 with air
execute store success score <moved_item> variable unless items entity @s inventory.5 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.5 from block 2 0 0 container.23
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.23 with air
execute store success score <moved_item> variable unless items entity @s inventory.6 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.6 from block 2 0 0 container.24
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.24 with air
execute store success score <moved_item> variable unless items entity @s inventory.7 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.7 from block 2 0 0 container.25
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.25 with air
execute store success score <moved_item> variable unless items entity @s inventory.8 *
execute if score <moved_item> variable matches 1 run item replace entity @s inventory.8 from block 2 0 0 container.26
execute if score <moved_item> variable matches 1 run item replace block 2 0 0 container.26 with air

# stop here if there are no more items left to transfer
execute unless items block 2 0 0 container.* * unless items block 2 1 0 container.* * run return 0

# if there are no remaining empty inventory slots, mail the player a bundle filled with the remaining items
execute unless predicate pandamium:player/can_pick_up_any_item run return run function pandamium:impl/take/sign_interact/return_items/offline

# if there is sufficient room to dump all remaining items, do so
function pandamium:utils/count_filled_inventory_slots
execute store result score <filled_chest_slots> variable if data block 2 0 0 Items[]
execute store result score <right_chest_slots> variable if data block 2 1 0 Items[]
scoreboard players operation <filled_chest_slots> variable += <right_chest_slots> variable
execute if score <filled_chest_slots> variable <= <empty_inventory_slots> variable run loot give @s mine 2 0 0 barrier[custom_data={drop_contents:true}]
execute if score <filled_chest_slots> variable <= <empty_inventory_slots> variable run return run loot give @s mine 2 1 0 barrier[custom_data={drop_contents:true}]

# otherwise, give the player a bundle filled with the remaining items
item replace block 5 0 0 contents with minecraft:bundle
data modify block 5 0 0 item.components.minecraft:bundle_contents append from block 2 0 0 Items[]
data modify block 5 0 0 item.components.minecraft:bundle_contents append from block 2 1 0 Items[]
loot replace block 2 0 0 container.0 27 loot pandamium:intentionally_empty
item replace block 2 0 0 container.0 from block 5 0 0 contents
loot give @s mine 2 0 0 barrier[custom_data={drop_contents:true}]
