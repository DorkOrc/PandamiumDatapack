execute store result score <was_modifying> variable run scoreboard players get <custom_dye.modifying> global
scoreboard players set <custom_dye.modifying> global 1

# check for rainbow items in every slot (except armour slots) and fix them if found
execute if items entity @s container.0 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.0"}
execute if items entity @s container.1 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.1"}
execute if items entity @s container.2 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.2"}
execute if items entity @s container.3 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.3"}
execute if items entity @s container.4 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.4"}
execute if items entity @s container.5 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.5"}
execute if items entity @s container.6 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.6"}
execute if items entity @s container.7 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.7"}
execute if items entity @s container.8 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.8"}
execute if items entity @s container.9 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.9"}
execute if items entity @s container.10 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.10"}
execute if items entity @s container.11 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.11"}
execute if items entity @s container.12 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.12"}
execute if items entity @s container.13 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.13"}
execute if items entity @s container.14 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.14"}
execute if items entity @s container.15 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.15"}
execute if items entity @s container.16 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.16"}
execute if items entity @s container.17 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.17"}
execute if items entity @s container.18 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.18"}
execute if items entity @s container.19 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.19"}
execute if items entity @s container.20 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.20"}
execute if items entity @s container.21 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.21"}
execute if items entity @s container.22 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.22"}
execute if items entity @s container.23 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.23"}
execute if items entity @s container.24 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.24"}
execute if items entity @s container.25 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.25"}
execute if items entity @s container.26 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.26"}
execute if items entity @s container.27 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.27"}
execute if items entity @s container.28 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.28"}
execute if items entity @s container.29 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.29"}
execute if items entity @s container.30 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.30"}
execute if items entity @s container.31 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.31"}
execute if items entity @s container.32 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.32"}
execute if items entity @s container.33 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.33"}
execute if items entity @s container.34 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.34"}
execute if items entity @s container.35 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"container.35"}
execute if items entity @s player.cursor *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"player.cursor"}
execute if items entity @s weapon.offhand *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"weapon.offhand"}
execute if items entity @s player.crafting.0 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"player.crafting.0"}
execute if items entity @s player.crafting.1 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"player.crafting.1"}
execute if items entity @s player.crafting.2 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"player.crafting.2"}
execute if items entity @s player.crafting.3 *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"player.crafting.3"}

# fix the items in armour slots if the player has disabled custom_dye armour
execute unless predicate pandamium:player/enabled_custom_dye if items entity @s armor.feet *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"armor.feet"}
execute unless predicate pandamium:player/enabled_custom_dye if items entity @s armor.legs *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"armor.legs"}
execute unless predicate pandamium:player/enabled_custom_dye if items entity @s armor.chest *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"armor.chest"}
execute unless predicate pandamium:player/enabled_custom_dye if items entity @s armor.head *[custom_data~{pandamium:{custom_dye:{}}}] run function pandamium:detect/obtain_custom_dyed_item/fix_item {slot:"armor.head"}

execute unless score <was_modifying> variable matches 1 run scoreboard players set <custom_dye.modifying> global 0

# reset
advancement revoke @s only pandamium:detect/obtain_custom_dyed_item
